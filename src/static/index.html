<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Wine Classifier</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Arial, sans-serif; margin: 24px; }
    h1 { margin-bottom: 8px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }
    label { font-size: 14px; display: block; margin-bottom: 4px; }
    input[type="number"] { width: 100%; padding: 8px; box-sizing: border-box; }
    .row { margin: 16px 0; }
    button { padding: 10px 16px; border: 0; border-radius: 8px; cursor: pointer; }
    .primary { background: #111827; color: white; }
    .ghost { background: #e5e7eb; color: #111827; }
    #result { font-size: 18px; margin-top: 16px; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; }
    .footer { color: #6b7280; font-size: 13px; margin-top: 12px; }
    .error { color: #b91c1c; }
  </style>
</head>
<body>
  <h1>üç∑ Wine Classifier</h1>
  <div class="footer">Enter features and click Predict. Uses your existing <code>POST /predict</code> API.</div>

  <form id="form">
    <div id="fields" class="grid"></div>
    <div class="row">
      <button type="submit" class="primary">Predict</button>
      <button type="button" id="reset" class="ghost">Reset</button>
    </div>
  </form>

  <div id="result" hidden></div>

  <script>
    // Only one preset: Wine (all 13 features)
    const wine13 = [
      ["alcohol", "Alcohol"],
      ["malic_acid", "Malic acid"],
      ["ash", "Ash"],
      ["alcalinity_of_ash", "Alcalinity of ash"],
      ["magnesium", "Magnesium"],
      ["total_phenols", "Total phenols"],
      ["flavanoids", "Flavanoids"],
      ["nonflavanoid_phenols", "Nonflavanoid phenols"],
      ["proanthocyanins", "Proanthocyanins"],
      ["color_intensity", "Color intensity"],
      ["hue", "Hue"],
      ["od280_od315_of_diluted_wines", "OD280/OD315 of diluted wines"],
      ["proline", "Proline"]
    ];

    const fieldsDiv = document.getElementById("fields");
    const form = document.getElementById("form");
    const result = document.getElementById("result");
    const resetBtn = document.getElementById("reset");

    // Render fields once
    function renderFields(list) {
      fieldsDiv.innerHTML = "";
      list.forEach(([name, label]) => {
        const wrap = document.createElement("div");
        const lab = document.createElement("label");
        lab.textContent = label;
        const input = document.createElement("input");
        input.type = "number";
        input.step = "any";
        input.required = true;
        input.name = name;
        wrap.appendChild(lab);
        wrap.appendChild(input);
        fieldsDiv.appendChild(wrap);
      });
    }

    renderFields(wine13);

    resetBtn.addEventListener("click", () => {
      form.reset();
      result.hidden = true;
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      result.hidden = true;
      result.classList.remove("error");

      // Build payload
      const data = {};
      wine13.forEach(([name]) => {
        const val = form.elements[name].value;
        data[name] = val === "" ? null : Number(val);
      });

      try {
        const r = await fetch("/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        const body = await r.json();

        if (!r.ok) {
          throw new Error(body?.detail || r.statusText);
        }

        const cls = body?.response;
        const labelMap = { 0: "class_0", 1: "class_1", 2: "class_2" };
        result.textContent = `Prediction: ${cls} (${labelMap[cls] ?? "unknown"})`;
        result.hidden = false;
      } catch (err) {
        result.textContent = "Error: " + (err.message || err);
        result.classList.add("error");
        result.hidden = false;
      }
    });
  </script>
</body>
</html>
